<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>H√°bitos | EvolvP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
/* === ESTILOS ORIGINALES (SIN CAMBIOS) === */
:root {
    --primary:#4CAF50;--bg:#f8fafc;--card-bg:#fff;
    --text-main:#1e293b;--text-muted:#64748b;
    --shadow:0 4px 12px rgba(0,0,0,.08);
    --warning:#f59e0b;--danger:#ef4444;
    --info:#3b82f6;--slate:#475569;--border:#f1f5f9;
}
[data-theme="dark"]{
    --bg:#1a1a1a;--card-bg:#2d2d2d;
    --text-main:#fff;--text-muted:#aaa;
    --border:#3d3d3d;--slate:#94a3b8;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',system-ui,sans-serif}
body{background:var(--bg);color:var(--text-main);height:100vh;display:flex;flex-direction:column;overflow:hidden}
.top-bar{background:linear-gradient(135deg,var(--primary),#66bb6a);color:#fff;padding:30px 20px;border-radius:0 0 30px 30px;box-shadow:var(--shadow);text-align:center}
.content{flex:1;overflow-y:auto;padding:20px;padding-bottom:180px}
.add-btn{position:fixed;right:20px;bottom:110px;width:64px;height:64px;border-radius:22px;background:var(--primary);color:#fff;font-size:26px;display:flex;align-items:center;justify-content:center;border:none}
.panel{position:fixed;bottom:-100%;left:0;right:0;background:var(--card-bg);border-radius:32px 32px 0 0;padding:30px 24px 40px;transition:.4s;z-index:201;max-height:90vh;overflow-y:auto}
.panel.active{bottom:0}
.overlay{position:fixed;inset:0;background:rgba(15,23,42,.6);display:none;z-index:200}
.overlay.active{display:block}
.form-group{margin-bottom:18px}
label{font-weight:700;font-size:14px;margin-bottom:8px;display:block;color:var(--text-muted)}
input,select{width:100%;padding:12px;border-radius:12px;border:2px solid var(--border);background:var(--bg)}
.btn-confirm{background:var(--primary);color:#fff;width:100%;padding:18px;border-radius:18px;border:none;font-weight:800}
</style>
</head>

<body>

<div class="top-bar"><h1>Centro de H√°bitos</h1></div>
<div class="content" id="habitList"></div>

<button class="add-btn" onclick="openPanel('createPanel')">
    <i class="fas fa-plus"></i>
</button>

<div class="overlay" id="overlay" onclick="closeAllPanels()"></div>

<!-- PANEL CREAR -->
<div class="panel" id="createPanel">
<h3 style="text-align:center;margin-bottom:25px">Nuevo Objetivo</h3>

<div class="form-group">
<label>Nombre del h√°bito</label>
<input type="text" id="newName" placeholder="Ej: Meditar 15 min">
</div>

<div class="form-group">
<label>Categor√≠a</label>
<select id="newCat"></select>
</div>

<button class="btn-confirm" onclick="action_save()">Crear H√°bito</button>
</div>

<script>
/* =====================================================
   BASE DE DATOS DE H√ÅBITOS (NO SE TOCA HISTORIAL)
===================================================== */
const DB_KEY = 'evolvp_habits_v3';

function getRawData(){
    const raw = localStorage.getItem(DB_KEY);
    return raw ? JSON.parse(raw) : { habitos: [] };
}

let appData = getRawData();

function save(){
    localStorage.setItem(DB_KEY, JSON.stringify(appData));
    render();
}

/* =====================================================
   üî• CATEGOR√çAS DESDE index.html (evolvp_data)
   ‚ùå SIN DEFAULTS
===================================================== */
function getCategoriasFromIndex(){
    const raw = localStorage.getItem('evolvp_data');
    if(!raw) return [];
    try{
        const data = JSON.parse(raw);
        return Array.isArray(data.categorias) ? data.categorias : [];
    }catch{
        return [];
    }
}

function loadCategories(){
    const categorias = getCategoriasFromIndex();
    const html = categorias.map(c=>`<option value="${c}">${c}</option>`).join('');
    document.getElementById('newCat').innerHTML = html;
}

/* =====================================================
   UI
===================================================== */
function openPanel(id){
    loadCategories();
    document.getElementById('overlay').classList.add('active');
    document.getElementById(id).classList.add('active');
}

function closeAllPanels(){
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    document.getElementById('overlay').classList.remove('active');
}

/* =====================================================
   CREAR H√ÅBITO
===================================================== */
function action_save(){
    const name = document.getElementById('newName').value.trim();
    const cat = document.getElementById('newCat').value;

    if(!name) return;
    if(!cat){
        alert("Primero cre√° una categor√≠a en Inicio.");
        return;
    }

    appData.habitos.push({
        id: Date.now(),
        nombre: name,
        categoria: cat,
        startDate: new Date().toISOString().split('T')[0],
        endDate: null,
        status: 'Activo'
    });

    save();
    closeAllPanels();
    document.getElementById('newName').value = '';
}

function render(){
    const list = document.getElementById('habitList');
    if(appData.habitos.length === 0){
        list.innerHTML = `<p style="text-align:center;opacity:.5;margin-top:80px">No hay h√°bitos</p>`;
        return;
    }
    list.innerHTML = appData.habitos.map(h=>`
        <div style="background:var(--card-bg);padding:15px;border-radius:18px;margin-bottom:12px">
            <b>${h.nombre}</b><br>
            <small>${h.categoria}</small>
        </div>
    `).join('');
}

window.onload = render;
</script>

</body>
</html>
